---
title: '[UX] 如何設計良好的 Submenu 使用者體驗'
date: '2024-05-08'
tags: ['user-experiences']
draft: false
summary: 今天學 pointer-friendly submenu experience
---

Bad case: https://www.books.com.tw/
Good case: https://www.walmart.com/

## 問題

選單 (Menu) 組件主要是讓使用者能夠選擇功能或是進行導覽的使用者介面，當需要呈現更詳細的子功能時，通常會使用子選單 (Submenu) 的方式來展開顯示。

然而，在使用子選單時常會遇到這樣的問題：當使用者將游標從父選單移向子選單時，如果中途游標離開了選單區域，其對應的子選單就會關閉。進而造成使用者體驗不佳。

| Bad Case                                                                         | Good Case                                                                        |
| -------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |
| ![pointer-friendly-submenu-experience](/static/images/blog/ux/menu/menu_bad.gif) | ![pointer-friendly-submenu-experience](/static/images/blog/ux/menu/menu_bad.gif) |

本篇文章將會探討如何解決這個問題，讓使用者在使用子選單時能夠有更好的體驗。

## 解決方案

### Adobe - React Specturm

Adobe 的設計系統 React Specturm 有針對如何優化子選單使用者體驗的部落格文章 [Creating a pointer-friendly submenu experience](https://react-spectrum.adobe.com/blog/creating-a-pointer-friendly-submenu-experience.html) 。

文內提到他們是透過預測游標的 **移動方向** 以及 **移動速度** 來判斷是否要關閉子選單。

在探討主要概念之前，要先知道如何定義有效移動，我們可以透過當前游標在頁面中的絕對座標向子選單中最高點與最低點各畫一條線，而得到的範圍就是有效移動的範圍。

<Image src="/static/images/blog/ux/menu/valid_area.png" alt="valid area" width="451" height="324" />

#### 移動方向

定義出有效的移動範圍後，接下來就來探討如何計算出游標的移動方向。

首先可以先透過當前游標的座標以及上一個座標的差值來計算出移動的角度，透過這個角度來判斷當前的游標是否在有效的移動範圍內。

移動角度可以透過 `Math.atan2` 將兩點的座標差值轉換成弧度，如下：

```javascript
const deltaX = currentX - previousX
const deltaY = currentY - previousY
const angle = Math.atan2(deltaY, deltaX)
```

> atan2(y, x) 所表達的意思是坐標原點為起點，指向 (x, y) 的射線在坐標平面上與x軸正方向之間的角的角度

而這個弧度，數學表示為 theta (θ)，其範圍是從 `-π` (-180deg) 到 `π` (180deg)，如果 `angle` 的值在有效範圍內，則表示游標在有效範圍內，反之則表示游標不在有效範圍內，即可關閉子選單。

<Sandpack lang="static">

```html file=index.html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pointer Angle Calculation</title>
    <style>
      h1 {
        font-size: 1rem;
      }
      section {
        font-family: Helvetica, sans-serif;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0;
        font-size: 1.5rem;
        position: relative;
      }

      output {
        position: absolute;
      }
    </style>
  </head>
  <body>
    <section>
      <div
        style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; border-radius: 50%; border: 1px solid #000;"
      >
        <div style="position: absolute; top: -40%; left: 50%; transform: translateX(-50%);">
          90°
        </div>
        <div style="position: absolute; top: 50%; left: 120%; transform: translateY(-50%);">0°</div>
        <div style="position: absolute; top: 120%; left: 50%; transform: translateX(-50%);">
          -90°
        </div>
        <div style="position: absolute; top: 50%; left: -40%; transform: translateY(-50%);">
          180°
        </div>
      </div>

      <div id="output" class="output"></div>
    </section>

    <script>
      const output = document.querySelector('.output')

      window.addEventListener('mousemove', (evt) => {
        // Get half of the width and height
        const w = window.innerWidth / 2
        const h = window.innerHeight / 2

        // Get the mouse coordinates
        const x = evt.clientX
        const y = evt.clientY

        // Get delta values
        const deltaX = x - w
        const deltaY = y - h

        // Calculate the angle between the mouse and the center of the screen
        const theta = Math.atan2(deltaY, deltaX)

        // Convert to degrees
        let angle = theta * (180 / Math.PI)

        output.innerHTML = `Angle: ${angle.toFixed(2)}°`
      })
    </script>
  </body>
</html>
```

</Sandpack>

<Image src="/static/images/blog/ux/menu/angle.png" alt="valid angle" width="451" height="324" />

在計算出游標正在移動的角度後，我們可以算當前的角度是否在有效的範圍內，也就是透過以下三個角度來判斷是否在有效範圍內：

`Θ top` ：由先前指針位置到子菜單內部頂部角形成的角度

`Θ bottom` ：由前一指針位置到子選單底部內角形成的角度

`Θ pointer` ：由前一指針位置到當前指針位置形成的角度（增量）

如果 `Θ pointer` 在 `Θ top` 與 `Θ bottom` 之間，則表示游標在有效範圍內，反之則表示游標不在有效範圍內，即可關閉子選單。

## 參考資料

1. [Adobe | Creating a pointer-friendly submenu experience](https://react-spectrum.adobe.com/blog/creating-a-pointer-friendly-submenu-experience.html)
2. [Amazon | Breaking down Amazon’s mega dropdown](https://bjk5.com/post/44698559168/breaking-down-amazons-mega-dropdown)
