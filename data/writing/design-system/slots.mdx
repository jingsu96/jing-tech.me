---
title: Design System 101 - è¨­è¨ˆæ¨¡å¼ x Slots æ’æ§½
date: '2023-09-24'
tags: ['è¨­è¨ˆç³»çµ±']
draft: false
authors: ['default']
topic: 'core'
order: 1
---

<TOCInline toc={props.toc} asDisclosure />

## ä»€éº¼æ˜¯ Slots ?

Slots, ä¹Ÿå¯ä»¥ç¨±ç‚ºæ’æ§½, å°±æ˜¯ä¸€å€‹é è¨­çš„å€å¡Š (placeholder)ï¼Œå…¶é¡§åæ€ç¾©ï¼Œå¯ä»¥é€é Slots åœ¨çµ„ä»¶ä¸­æ’å…¥ä»»ä½•é å…ˆå®šç¾©çš„å…§å®¹ï¼ŒåŒ…å«å…¶ä»–çµ„ä»¶ã€æ–‡å­—ã€åœ–ç‰‡ç­‰ç­‰ã€‚

<Image src="https://imgur.com/VBZVXr4.png" height="440" width="708" />

## ç‚ºä»€éº¼éœ€è¦ Slots ?

åœ¨ä»‹ç´¹ Slots ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†æ¢è¨ç¾ä»Š React çµ„ä»¶ä¸­æœ€å¸¸è¦‹çš„å…©ç¨® API è¨­è¨ˆæ–¹å¼ï¼šé…ç½®æ¨¡å¼ (Configuration) å’Œçµ„åˆæ¨¡å¼ (Composition)ã€‚å†æ·±å…¥ç­è§£ Slots æ˜¯å¦‚ä½•ç‚ºå…¶æä¾›è§£æ±ºæ–¹æ¡ˆçš„ã€‚

### é…ç½®æ¨¡å¼ (Configuration)

èªªåˆ°äº†é…ç½®æ¨¡å¼ï¼Œå°±è®“ç­†è€…å›æƒ³åˆ°ç•¶åˆåœ¨å»º `<TextInput />` æˆ–æ˜¯å…¶ä»–ä¸€äº›æ¯”è¼ƒè¤‡é›œçš„çµ„ä»¶ï¼Œæ™‚å¸¸æœƒé‡åˆ°éœ€è¦ **å®¢è£½åŒ–** çš„æƒ…æ³ã€‚

è€Œé‚£æ™‚å€™çš„è§£æ³•éƒ½æ˜¯é€éå‚³å…¥ props å¤§æ³•ï¼Œé›–ç„¶é€™æ¨£çš„æ–¹æ³•åœ¨çŸ­æœŸå…§æ˜¯æœ‰æ•ˆçš„ï¼Œä½†éš¨è‘—éœ€æ±‚çš„å¢åŠ ï¼Œçµ„ä»¶çš„ API ä¹Ÿæœƒè®Šå¾—è¶Šä¾†è¶Šç¹é–ã€‚

ä»¥ä¸‹ç­†è€…å°‡ç”¨ `<TextInput />` èˆ‰ä¾‹ï¼Œ ä¸€èµ·ä¾†çœ‹çœ‹å…¶çµ„ä»¶çš„æˆé•·å²ã€‚

é¦–å…ˆ v1 ç‰ˆæœ¬é€šå¸¸æœƒæ˜¯å’Œçµ„ä»¶çš„è¨­è¨ˆæŒ‡å—ä¸€æ¨£ï¼Œæœ‰åŸºæœ¬çš„ `label`ã€`input`ã€`helperText`ï¼Œé€™æ™‚å€™çš„çµ„ä»¶å¯èƒ½æœƒé•·é€™æ¨£

```jsx
// v1
const TextInput = ({ label, helperText, icon, ...props }) => {
  return (
    <div className="text-input">
      <label>{label}</label>
      <input {...props} />
      <span className="helper-text">{helperText}</span>
      {icon}
    </div>
  )
}
```

ç„¶è€Œï¼Œéš¨è‘—æ™‚é–“çš„é€²å±•ï¼Œå¯èƒ½æœ‰åŒäº‹æå‡ºéœ€è¦æ”¹è®Š `label` çš„é¡è‰²ã€‚æ–¼æ˜¯æˆ‘å€‘å¼•å…¥ `labelProps` ä»¥ä¾¿é–‹ç™¼è€…é€²è¡Œå®¢è£½åŒ–ï¼š

```jsx
// v2
const TextInput = ({ label, helperText, icon, labelProps, ...props }) => {
  return (
    <div className="text-input">
      <label {...labelProps}>{label}</label>
      <input {...props} />
      <span className="helper-text">{helperText}</span>
      {icon}
    </div>
  )
}
```

ä¸ä¹…ä¹‹å¾Œï¼Œåˆæœ‰åŒäº‹åæ‡‰èªªéœ€è¦ `input` éœ€è¦åŠ å…¥å‰ç¶´èˆ‡å¾Œç¶´ï¼Œæ–¼æ˜¯æˆ‘å€‘å°±åŠ å…¥ `prefix` èˆ‡ `suffix` è®“é–‹ç™¼è€…å¯ä»¥è‡ªç”±çš„å®¢è£½åŒ– `prefix` èˆ‡ `suffix`ã€‚

```jsx
// v3
const TextInput = ({
  label,
  helperText,
  icon,
  labelProps,
  prefix,
  prefixProps,
  suffix,
  suffixProps,
  ...props
}) => {
  return (
    <div className="text-input">
      <label {...labelProps}>{label}</label>
      <div>
        {prefix && <span {...prefixProps}>{prefix}</span>}
        <input {...props} />
        {suffix && <span {...suffixProps}>{suffix}</span>}
      </div>
      <span className="helper-text">{helperText}</span>
      {icon}
    </div>
  )
}
```

éš¨è‘—è¨­è¨ˆåƒå¥‡ç™¾æ€ªçš„éœ€æ±‚è¿é¢è€Œä¾†ï¼Œç‚ºäº†è®“çµ„ä»¶èƒ½å¤ è¤‡ç”¨ï¼Œæˆ‘å€‘å°±æœƒéœ€è¦è¶Šä¾†è¶Šå¤šçš„ props ä¾†å®¢è£½åŒ–çµ„ä»¶ï¼Œåˆ°æœ€å¾Œ `<TextInput />` API å¯èƒ½æœƒéå¸¸å†—é•·ï¼Œè®“çµ„ä»¶è®Šå¾—é›£ä»¥ç¶­è­·ï¼Œä¸”æ··åˆäº†å„ç¨®é‚è¼¯ã€‚

è€Œçµ„åˆæ¨¡å¼çš„å‡ºç¾ï¼Œæ­£æ˜¯ç‚ºäº†å˜—è©¦è§£æ±ºé€™æ¨£çš„å•é¡Œã€‚æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†çœ‹çœ‹çµ„åˆæ¨¡å¼å¦‚ä½•é”åˆ°é€™å€‹ç›®çš„ã€‚

### çµ„åˆæ¨¡å¼ (Composition)

React æ˜¯ä¸€å€‹çµ„ä»¶åŒ–çš„ UI æ¡†æ¶ï¼Œè€Œçµ„ä»¶åŒ–çš„å¥½è™•å°±æ˜¯å¯ä»¥å°‡ä¸€å€‹å¤§çš„çµ„ä»¶æ‹†åˆ†æˆæ›´å°çš„çµ„ä»¶ï¼Œä¸¦ä¸”å¯ä»¥è¤‡ç”¨ã€‚é€™å°±æ˜¯çµ„åˆæ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³ã€‚

```jsx
<TextField>
  <TextField.Label />
  <TextField.Input />
  <TextField.HelperText />
  <TextField.Icon />
</TextField>
```

é€™ç¨®æ–¹å¼æä¾›é–‹ç™¼è€…å¯ä»¥éˆæ´»é‹ç”¨çµ„ä»¶ï¼Œè‡ªç”±çš„å®šåˆ¶çµ„ä»¶çš„æ¯ä¸€éƒ¨åˆ†ï¼Œä½†é€™å¼•èµ·äº†å¦ä¸€å€‹å•é¡Œï¼šä¸€è‡´æ€§ï¼Œä½¿ç”¨è€…å¿…é ˆæŒ‰ç…§é æœŸçš„é †åºæ”¾å…¥å­çµ„ä»¶ï¼Œå¦å‰‡å¯èƒ½æœƒå°è‡´ Accessibility å•é¡Œã€‚

èˆ‰ä¾‹ä¾†èªª `<TextField />` çµ„ä»¶çš„é †åºæ‡‰è©²æ˜¯ `Label` -> `Input` -> `HelperText` -> `Icon`ã€‚

æ­¤æ™‚ä½¿ç”¨è€…å°‡ `Label` æ”¾åœ¨æœ€å¾Œé¢ï¼Œä¸¦é€é CSS å°‡ `Label` ç§»åˆ° `Input` çš„ä¸Šæ–¹ï¼Œé€™æ¨£å°±æœƒå°è‡´ Accessibility å•é¡Œï¼Œå› ç‚ºå°æ–¼ Screen Reader ä½¿ç”¨è€…ä¾†èªªï¼Œå› ç‚ºä»–å€‘å¯èƒ½é¦–å…ˆæ¥è§¸åˆ°çš„æ˜¯ Inputï¼Œå»é‚„ä¸çŸ¥é“é€™å€‹è¼¸å…¥æ¡†çš„å…·é«”ç”¨é€”ã€‚

## Slots æ¦‚å¿µ

### Slots - Web Components

åœ¨ä»‹ç´¹å¦‚ä½•è¨­è¨ˆ React Slots ä¹‹å‰æˆ‘å€‘å¯ä»¥é€é Web Components çš„ API ä¾†çœ‹çœ‹ Slots æ˜¯å¦‚ä½•è§£æ±ºé€™å€‹å•é¡Œçš„ã€‚

èˆ‰ä¾‹ä¾†èªªï¼Œç¾åœ¨è¦è¨­è¨ˆä¸€å€‹ `Button` çµ„ä»¶ï¼Œæœ‰äº† Slots æˆ‘å€‘å°±å¯ä»¥ Slot çš„ä½ç½®ï¼Œåƒæ˜¯æŒ‰éˆ•çš„æ–‡å­—ï¼Œä¸¦ä¸”çµ¦äºˆä¸€å€‹é è¨­çš„å…§å®¹ï¼Œç•¶æœ‰éœ€è¦å®¢è£½åŒ–çš„æ™‚å€™ï¼Œå°±å¯ä»¥é€é `slot` å±¬æ€§ç›´æ¥ä¾†æ’å…¥å…§å®¹ã€‚

<Sandpack lang="static">

```html file=index.html
<body>
  <template id="button-component">
    <button>
      <slot name="text">Default Button</slot>
    </button>
  </template>

  <button-component>
    <!--   <span slot="text">Click Me</span>  -->
  </button-component>
</body>
<script>
  customElements.define(
    'button-component',
    class extends HTMLElement {
      constructor() {
        super()
        const template = document.getElementById('button-component')
        const templateContent = template.content

        const shadowRoot = this.attachShadow({ mode: 'open' })
        shadowRoot.appendChild(templateContent.cloneNode(true))
      }
    }
  )
</script>
```

</Sandpack>

### Slots - React

åœ¨ React ä¸­ï¼Œé›–ç„¶æ²’æœ‰åŸç”Ÿ Slots APï¼Œä½†æˆ‘å€‘å¯ä»¥é€é `children` ä¾†é”åˆ°ç›¸åŒçš„æ•ˆæœï¼Œä½†æ˜¯ `children` ä¸¦æ²’æœ‰æä¾›åç¨±çš„æ¦‚å¿µï¼Œå› æ­¤éœ€è¦é€é `props` ä¾†å®šç¾©ã€‚

#### Default Slot

é¦–å…ˆï¼Œå…ˆä»‹ç´¹ç•¶åªéœ€è¦å®šç¾©ä¸€å€‹ Slot, è®“æˆ‘å€‘ä¾†çœ‹çœ‹å¦‚ä½•é€é `children` ä¾†å¯¦ç¾ Slotsã€‚

```jsx
const Button = ({ children }) => {
  return <button>{children || 'Default Button'}</button>
}
```

é€™æ¨£çš„å¯«æ³•ï¼Œå°±å¯ä»¥è®“é–‹ç™¼è€…åœ¨ä½¿ç”¨ `<Button />` çµ„ä»¶æ™‚ï¼Œå¯ä»¥è‡ªç”±çš„æ’å…¥ä»»ä½•å…§å®¹ã€‚

```jsx
<Button>
  <span>Click Me</span>
</Button>
```

#### Named Slots

ç•¶éœ€è¦å®šç¾©å¤šå€‹ Slots æ™‚ï¼Œä¾‹å¦‚ Button èˆ‡ Icon, æ­¤æ™‚æˆ‘å€‘å¯ä»¥é€é `props` ä¾†å®šç¾©

```jsx
const Button = ({ icon, content }) => {
  return (
    <button>
      {icon}
      {content || 'Default Button'}
    </button>
  )
}
```

è€Œé€™å€‹åšæ³•æœ‰ä¸€å€‹ç¼ºé»ï¼Œæ‰€æœ‰çš„ Slot éƒ½éœ€è¦é€é `props` ä¾†å®šç¾©ã€‚

```jsx
<Button icon={<Icon />} content={<span>Click Me</span>} />
```

#### Slots with `createSlots`

ç‚ºäº†è§£æ±ºä¸Šé¢çš„å•é¡Œï¼Œå¯ä»¥èˆ‡çµ„åˆæ¨¡å¼çš„æ¦‚å¿µé€²è¡Œçµåˆï¼Œä¸¦é€ééæ­· React Children çš„æ–¹å¼æ‰¾åˆ°æ¯å€‹å­çµ„ä»¶çš„å‹åˆ¥ï¼Œä¸¦ä¸”å°‡å…¶æ”¾å…¥å°æ‡‰çš„ Slot ä¸­ã€‚

é¦–å…ˆä½¿ç”¨æ–¹å¼å¤§æ¦‚æœƒåƒé€™æ¨£

```jsx
<Button>
  <Icon>ğŸ–•</Icon>
  <Content>Click Me!</Content>
</Button>
```

è€Œ JSX æœƒè¢«è½‰æ›æˆä»¥ä¸‹çš„çµæ§‹

```jsx
{
  type: function Button() {},
  props: {
    children: [
      {
        type: function Icon() {},
        props: {},
      },
      {
        type: function Content() {},
        props: {
          children: 'Click Me',
        },
      },
    ],
  },
}
```

å†é€éé€™å€‹çµæ§‹ï¼Œéæ­· `children` ä¾†æ‰¾åˆ°æ¯å€‹å­çµ„ä»¶çš„å‹åˆ¥ï¼Œä¸¦ä¸”å°‡å…¶æ”¾å…¥å°æ‡‰çš„ Slot ä¸­ã€‚

<Sandpack>

```js file=App.js
import React from 'react'

function ButtonContent(props) {
  return <>{props.children}</>
}

function Icon(props) {
  return <>{props.children}</>
}

const Button = (props) => {
  const { children } = props

  let icon = null
  let content = null

  React.Children.forEach(children, (child) => {
    if (!React.isValidElement(child)) return null
    if (child.type === Icon) {
      icon = child
    } else {
      content = child
    }
  })

  console.log(icon, content)

  return (
    <button>
      {icon}
      {content || 'Default Button'}
    </button>
  )
}

export default () => {
  return (
    <Button>
      <Icon>ğŸ–•</Icon>
      <ButtonContent>Click Me!</ButtonContent>
    </Button>
  )
}
```

</Sandpack>

è€Œå¾ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘å€‘å¯ä»¥é€é `slot` å±¬æ€§ä¾†æ’å…¥å…§å®¹ï¼Œå°±å¯ä»¥è§£æ±º Configuration æ¨¡å¼çš„ç—›é»ï¼Œä¸ç”¨å†å‚³å…¥éå¤šçš„ props ä¾†å®¢è£½åŒ–çµ„ä»¶ã€‚ä¹Ÿå¯ä»¥è§£æ±º Composition æ¨¡å¼çš„ç—›é»ï¼Œå› ç‚ºé–‹ç™¼è€…å¯ä»¥è‡ªç”±çš„æ’å…¥å…§å®¹ï¼Œè€Œä¸ç”¨æ“”å¿ƒé †åºçš„å•é¡Œã€‚

#### Slots with Context API

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘å€‘é€ééæ­· React Children çš„æ–¹å¼æ‰¾åˆ°æ¯å€‹å­çµ„ä»¶çš„å‹åˆ¥ï¼Œä¸¦ä¸”å°‡å…¶æ”¾å…¥å°æ‡‰çš„ Slot ä¸­ï¼Œä½†é€™æ¨£çš„æ–¹å¼æœ‰ä¸€å€‹ç¼ºé»ï¼Œå°±æ˜¯ç•¶çµ„ä»¶çš„å±¤ç´šè¶Šæ·±ï¼Œå°±éœ€è¦è¶Šå¤šçš„éæ­·ï¼Œé€™æ¨£çš„æ•ˆèƒ½æœƒè®Šå¾—è¶Šä¾†è¶Šå·®ã€‚

æˆ‘å€‘å¯ä»¥é€é React Context API ä¾†è§£æ±ºé€™å€‹å•é¡Œï¼Œé¦–å…ˆå…ˆå»ºç«‹ä¸€å€‹ Context

```jsx
const ButtonContext = React.createContext({
  slots: {
    icon: null,
    content: null,
  },
})
```

å†ä¾†å°±æ˜¯é€é `ButtonContext.Provider` ä¾†åŒ…ä½å­çµ„ä»¶ï¼Œä¸¦ä¸”å¯ä»¥é€é `slots` ä¾†å®šç¾©æ¯å€‹ Slot çš„å…§å®¹

```jsx
const ButtonContextProvider = ({ children, slots }) => {
  return <ButtonContext.Provider value={slots}>{children}</ButtonContext.Provider>
}
```

æœ€å¾Œå»ºç«‹ä¸€å€‹ `useButtonContext` ä¾†å–å¾— Context çš„å€¼

```jsx
const useButtonContext = (props, slotName) => {
  const context = React.useContext(ButtonContext)

  return { ...(props || {}), ...(context?.[slotName] || {}) }
}
```

æœ€å¾Œå†å»ºç«‹ Button èˆ‡ Icon çµ„ä»¶æ™‚ï¼ŒåŠ å…¥ `useButtonContext` ä¾†å–å¾—ç›¸å°æ‡‰ Slot çš„å…§å®¹

```jsx
const ICONS = {
  play: 'â¯ï¸',
  thumbUp: 'ğŸ‘',
};

const Icon = (props: { type: string }) => {
  props = useButtonContext(props, 'icon');

  return (
    <span style={{ marginRight: '4px', display: 'inline-flex' }} {...props}>
      {ICONS[props.type]}
    </span>
  );
};

const Button = (props: { children: React.ReactNode }) => {
  props = useButtonContext(props, 'button');

  return (
    <button {...props}>
      <Icon type="play" />
      {props.children}
    </button>
  );
};
```

<Sandpack>

```js file=App.js
import React from 'react'

const ButtonContext = React.createContext({
  slots: {
    icon: null,
    button: null,
  },
})

const useButtonContext = (props, slotName) => {
  const context = React.useContext(ButtonContext)

  return { ...(props || {}), ...(context?.[slotName] || {}) }
}

const ButtonContextProvider = ({ children, slots }) => {
  return <ButtonContext.Provider value={slots}>{children}</ButtonContext.Provider>
}

const ICONS = {
  play: 'â¯ï¸',
  thumbUp: 'ğŸ‘',
}

const Icon = (props) => {
  props = useButtonContext(props, 'icon')

  return (
    <span style={{ marginRight: '4px', display: 'inline-flex' }} {...props}>
      {ICONS[props.type]}
    </span>
  )
}

const Button = (props) => {
  props = useButtonContext(props, 'button')

  return (
    <button {...props}>
      <Icon type="play" />
      {props.children}
    </button>
  )
}

export default () => {
  return (
    <ButtonContextProvider
      slots={{
        icon: {
          type: 'thumbUp',
          style: { marginRight: '4px' },
        },
      }}
    >
      <Button>Play!!!</Button>
    </ButtonContextProvider>
  )
}
```

</Sandpack>

è€Œé€™å°±æ˜¯ç”¨ React Context API å»ºç«‹ Slots é€™å€‹æ¦‚å¿µï¼Œä¹Ÿæ˜¯ç›®å‰ [Adobe React-Spectrum Slot](https://github.com/adobe/react-spectrum/blob/main/rfcs/2019-v3-slots.md) çš„è¨­è¨ˆæ–¹å¼ï¼Œé€é Context API ä¾†å®šç¾© Slots çš„å…§å®¹ï¼Œä¸¦ä¸”é€é `useSlotProps` ä¾†å–å¾—ç›¸å°æ‡‰ Slot çš„å€¼ã€‚

æ¥è‘—ä¾†æ¢è®€ [Adobe React-Spectrum Slot](https://github.com/adobe/react-spectrum/blob/main/rfcs/2019-v3-slots.md) æ˜¯å¦‚ä½•å»ºç«‹ `Slots` çµ„ä»¶ï¼Œåœ¨é€™ä¹‹å‰ï¼Œæˆ‘å€‘ä¸ä»¿æƒ³ä¸€ä¸‹å¦‚ä½•è®“ä¸Šé¢çš„ä¾‹å­é©ç”¨æ–¼ä¸åŒçš„çµ„ä»¶ä¸­ï¼Œé€™æ™‚æˆ‘å€‘å¯èƒ½éœ€è¦ä»¥ä¸‹çš„ API

##### **API**

| Name           | Description           | Params                 |
| -------------- | --------------------- | ---------------------- |
| `SlotProvider` | å»ºç«‹ Slots çš„ Context | `slots`                |
| `useSlotProps` | ä½¿ç”¨å°æ‡‰ Slot çš„å…§å®¹  | `props`, `defaultSlot` |
| `mergeProps`   | åˆä½µæ‰€æœ‰çš„ props      | `args`                 |

##### **Slot - SlotProvider**

åœ¨æ­£å¼é€²å…¥å¯¦ä½œä¹‹å‰ï¼Œè¦å…ˆæ€è€ƒä¸€ä¸‹ç•¶é–‹ç™¼è€…å°åŒä¸€å€‹ slot å‚³å…¥é‡è¤‡çš„ `props` æˆ‘å€‘è¦å¦‚ä½•è™•ç†ï¼Œä¾‹å¦‚ä»¥ä¸‹çš„ä¾‹å­

```jsx
<SlotProvider
  slots={{ icon: { type: 'play' }, className: 'mb-4', onClick={myClickLogic} }}
>
  <SlotProvider
    slots={{ icon: { type: 'pause' }, className: 'd-flex', onClick={defaultClickLogic} }}
  >
    <Button />
  </SlotProvider>
</SlotProvider>
```

é€™æ™‚å¾Œæˆ‘å€‘è¦ä¿ç•™æœ€å¤–å±¤çš„ `type` (å› ç‚ºé€™æ˜¯æœ€å¾Œä¸€å€‹å‚³å…¥çš„å€¼)ï¼Œä½†æ˜¯ `className` å‰‡æ˜¯è¦åˆä½µï¼Œæœ€å¾Œ `onClick` é€™ç¨®äº‹ä»¶è¡Œå‡½å¼å‰‡æ˜¯è¦é€£çºŒçš„å‘¼å«ï¼Œé€™æ™‚å€™æˆ‘å€‘å°±å¯ä»¥é€é `mergeProps` ä¾†è§£æ±ºé€™å€‹å•é¡Œã€‚

```jsx
export const chain = (...fns) => {
  return (...args) => {
    fns.forEach((fn) => typeof fn === 'function' && fn?.(...args))
  }
}

export const mergeProps = (...args) => {
  const result = { ...args[0] }

  for (let i = 1; i < args.length; i++) {
    const props = args[i]

    for (const key in props) {
      const a = result[key]
      const b = props[key]

      if (
        typeof a === 'function' &&
        typeof b === 'function' &&
        key.startsWith('on') &&
        key.charCodeAt(2) <= 90 &&
        key.charCodeAt(2) >= 65
      ) {
        result[key] = chain(a, b)
        continue
      }

      if (key === 'className') {
        result[key] = clsx(a, b)
        continue
      }

      result[key] = b === undefined ? a : b
    }
  }

  return result
}
```

å†ä¾†æˆ‘å€‘å°±å¯ä»¥å¯¦ä½œ `SlotProvider` äº†ï¼Œå› ç‚º React Context åªæœƒå–æœ€è¿‘çš„ä¸€å±¤ Contextï¼Œå¦‚æœä¹Ÿè¦è®“å…¶ä»–é–‹ç™¼è€…æ”¾å…¥ slot åƒæ•¸éƒ½å¯ä»¥è¢«å–åˆ°ï¼Œé€é `useContext` å…ˆå–å¾— parentSlotsï¼Œ

é€é `reduce` å°‡ç›¸åŒçš„ slot çµ„åˆèµ·ä¾†ï¼Œ ä¸¦å°‡ `slots` èˆ‡ `parentSlots` é€é `mergeProps` çš„æ–¹å¼é€²è¡Œåˆä½µï¼Œæœ€å¾Œç”¨ `useMemo` å°‡çµæœé€²è¡Œå„²å­˜ï¼Œé¿å…é‡è¤‡è¨ˆç®—ã€‚

```jsx
const SlotContext = React.createContext(null)

const SlotProvider = (props) => {
  const parentSlots = useContext(SlotContext) || {}
  const { slots = {}, children } = props

  const value = useMemo(() => {
    return Object.keys(parentSlots)
      .concat(Object.keys(slots))
      .reduce(
        (acc, props) => ({
          ...acc,
          [props]: mergeProps(parentSlots[props] || {}, slots[props] || {}),
        }),
        {}
      )
  }, [parentSlots, slots])

  return <SlotContext.Provider value={value}>{children}</SlotContext.Provider>
}
```

##### **Slot - useSlotProps**

`useSlotProps` å‰‡ç›¸å°ç°¡å–®ï¼Œæˆ‘å€‘åªéœ€è¦å–å¾— `slot` çš„å€¼ï¼Œä¸¦ä¸”å›å‚³å°æ‡‰çš„ `props` å³å¯ã€‚

```jsx
const useSlotProps = <T,>(props: T & { id?: string }, defaultSlot?: string) => {
  const slot = (props as SlotProps).slot || defaultSlot;
  const context = useContext(SlotContext) || {};

  return mergeProps(props, mergeProps(slot ? (context as any)[slot] : {}, { id: props.id }));
};
```

##### **Slot with Button**

æœ€å¾Œå†å°‡ä¸Šé¢çš„ API æ‡‰ç”¨åˆ° Button çµ„ä»¶ä¸­ï¼Œé¦–å…ˆæˆ‘å€‘å…ˆå®šç¾© Button, Icon çµ„ä»¶ï¼Œä¸¦ä¸”æœ‰äº† `SlotProvider` ä¹‹å¾Œï¼Œå°±å¯ä»¥æ”¹ Button æˆ–æ˜¯ Icon çš„åƒæ•¸

<Sandpack>

```js file=App.js
import React, { useContext, useMemo } from 'react'

const chain = (...fns) => {
  return (...args) => {
    fns.forEach((fn) => typeof fn === 'function' && fn?.(...args))
  }
}

const mergeProps = (...args) => {
  const result = { ...args[0] }

  for (let i = 1; i < args.length; i++) {
    const props = args[i]

    for (const key in props) {
      const a = result[key]
      const b = props[key]

      if (
        typeof a === 'function' &&
        typeof b === 'function' &&
        key.startsWith('on') &&
        key.charCodeAt(2) <= 90 &&
        key.charCodeAt(2) >= 65
      ) {
        result[key] = chain(a, b)
        continue
      }

      if (key === 'className') {
        result[key] = clsx(a, b)
        continue
      }

      result[key] = b === undefined ? a : b
    }
  }

  return result
}

const SlotContext = React.createContext(null)

const SlotProvider = (props) => {
  const parentSlots = useContext(SlotContext) || {}
  const { slots = {}, children } = props

  const value = useMemo(() => {
    return Object.keys(parentSlots)
      .concat(Object.keys(slots))
      .reduce(
        (acc, props) => ({
          ...acc,
          [props]: mergeProps(parentSlots[props] || {}, slots[props] || {}),
        }),
        {}
      )
  }, [parentSlots, slots])

  return <SlotContext.Provider value={value}>{children}</SlotContext.Provider>
}

const useSlotProps = (props, defaultSlot) => {
  const slot = props.slot || defaultSlot
  const context = useContext(SlotContext) || {}

  return mergeProps(props, mergeProps(slot ? context[slot] : {}, { id: props.id }))
}

const ICONS = {
  play: 'â¯ï¸',
  thumbUp: 'ğŸ‘',
}

const Icon = (props) => {
  props = useSlotProps(props, 'icon')

  return (
    <span style={{ marginRight: '4px', display: 'inline-flex' }} {...props}>
      {ICONS[props.type]}
    </span>
  )
}

const Button = (props) => {
  props = useSlotProps(props, 'button')

  return (
    <button {...props}>
      <Icon type="play" />
      {props.children}
    </button>
  )
}

export default () => {
  return (
    <SlotProvider
      slots={{
        button: {
          style: { display: 'flex', alignItems: 'center' },
        },
        icon: {
          style: { marginRight: '8px', display: 'inline-flex' },
          type: 'thumbUp',
        },
      }}
    >
      <Button>Play!!</Button>
    </SlotProvider>
  )
}
```

</Sandpack>
